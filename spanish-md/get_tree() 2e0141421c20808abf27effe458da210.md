# get_tree()

**`get_tree()`** devuelve una referencia única al **árbol de escena** actual (un objeto **`SceneTree`**), que es el “director de orquesta” del juego. Esa referencia permite gestionar escenas, nodos, el ciclo de juego, señales globales, pausa, grupos y más.

## Qué es **`SceneTree`**

- **`SceneTree`** es el objeto que contiene todo el árbol de nodos que se está ejecutando (la escena actual y sus hijos).
- Acceder a **`get_tree()`** desde cualquier nodo te da una puerta de entrada global para controlar el juego.

```python
var tree := get_tree()
```

## Gestión de escenas

- Permite cambiar de escena, recargar o instanciar nuevas escenas de forma global.
- Es la forma estándar de ir de “Menú principal” a “Nivel 1”, etc.

```python
# Cambiar de escena
get_tree().change_scene_to_file("res://scenes/level_1.tscn")

# Recargar la escena actual
get_tree().reload_current_scene()
```

## Pausa y estado global

- **`SceneTree`** controla si el juego está pausado y cómo reaccionan los nodos a esa pausa.
- Combinado con **`pause_mode`** de los nodos, define qué sigue ejecutándose durante la pausa.

```python
# Pausar / despausar el juego
get_tree().paused = true
get_tree().paused = false

# Salir del juego
get_tree().quit()
```

## Acceso al nodo raíz y búsqueda

- El árbol tiene un **root** del que cuelga todo; desde ahí se pueden obtener nodos por ruta.
- Es útil para acceder a nodos “lejanos” sin almacenar referencias en todas partes (aunque conviene no abusar).

```python
# Obtener el nodo raíz de la escena actual
var root := get_tree().current_scene

# Buscar un nodo por ruta absoluta en la escena
var player := get_tree().current_scene.get_node("Player")
```

También se puede usar **`get_tree().root`** para acceder al root visual absoluto (por encima de la escena actual).

---

## Grupos y señales globales

- **`SceneTree`** sabe qué nodos pertenecen a qué grupos, y puede emitir métodos a todos juntos.
- Esto permite comunicaciones sueltas (desacopladas) entre nodos.

```python
# Llamar a un método en todos los nodos del grupo "enemies"
get_tree().call_group("enemies", "take_damage", 10)

# Pausar solo un grupo (ejemplo avanzado usando lógica propia)
for enemy in get_tree().get_nodes_in_group("enemies"):
    enemy.set_process(false)
```

## Gestión del ciclo de juego

- **`SceneTree`** maneja escenas, procesado, enter/exit tree, conexiones de señales, etc.
- Permite engancharse a señales globales como “cuando cambia de escena” o “cuando se pausa”.

```python
func _ready() -> void:
    get_tree().connect("scene_changed", Callable(self, "_on_scene_changed"))

func _on_scene_changed(new_scene):
    print("Nueva escena: ", new_scene.name)
```